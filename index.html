<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Bloxd Tier Calculator</title>

<style>
:root {
  --bg-sky:#5fb3ff; --bg-sky-2:#9fd3ff;
  --panel:#1a1f2b; --panel-soft:#22283a;
  --border:#3a4060;
  --text-main:#eef3ff; --text-soft:#b8c2ff;
  --ht1:#ffd54a; --ht2:#ffbf00;
  --lt1:#4db3ff; --lt2:#2f7dff;
  --accent-green:#47ff9a; --accent-red:#ff4b4b;
}

body{
  margin:0; min-height:100vh;
  font-family:Arial,sans-serif;
  background:radial-gradient(circle at top,var(--bg-sky-2),var(--bg-sky)),
             linear-gradient(to bottom,#5fb3ff 0%,#3b78c8 50%,#1b2a44 100%);
  display:flex; justify-content:center; align-items:center;
  color:var(--text-main);
}

.container{
  width:100%; max-width:540px;
  padding:22px;
  background:linear-gradient(180deg,var(--panel),var(--panel-soft));
  border-radius:14px;
  border:2px solid var(--border);
  box-shadow:0 18px 40px rgba(0,0,0,.6);
  text-align:center;
  position:relative;
}

input,select,button{
  width:90%; margin:8px auto;
  padding:10px; font-size:15px;
  border-radius:6px;
  border:2px solid var(--border);
  background:#0f1422;
  color:var(--text-main);
}

button{
  background:linear-gradient(180deg,#3a7bff,#235bff);
  border:none; font-weight:bold;
  cursor:pointer;
  box-shadow:0 4px 0 #173caa;
}
button:active{transform:translateY(2px)}

#musicBtn{
  position:absolute; top:14px; right:14px;
  width:auto; padding:6px 10px;
}

.invalid{
  animation:shake .35s;
  border-color:var(--accent-red)!important;
  background:#2a1212!important;
}
@keyframes shake{
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-6px)}
}

.round-card{
  background:linear-gradient(180deg,#202741,#171c33);
  border:2px solid var(--border);
  border-radius:12px;
  padding:16px;
  animation:slideIn .35s ease forwards;
}
@keyframes slideIn{
  from{opacity:0; transform:translateY(25px)}
  to{opacity:1; transform:translateY(0)}
}
.round-exit{
  animation:slideOut .3s ease forwards;
}
@keyframes slideOut{
  to{opacity:0; transform:translateY(-25px)}
}

.tier-card{
  margin:18px auto;
  padding:18px;
  border-radius:14px;
  background:linear-gradient(180deg,#202741,#171c33);
  border:2px solid var(--border);
}
.tier-badge{
  font-size:26px;
  padding:14px 22px;
  border-radius:10px;
  font-weight:bold;
  color:#000;
}
.ht{background:linear-gradient(145deg,var(--ht1),var(--ht2))}
.lt{background:linear-gradient(145deg,var(--lt1),var(--lt2))}

.copy-box{
  margin-top:14px;
  background:#0d1220;
  border:2px solid var(--border);
  padding:12px;
  border-radius:8px;
  white-space:pre-line;
  cursor:pointer;
}
.copy-box.copied{
  border-color:var(--accent-green);
  background:#0f2a1d;
}
.hidden{display:none}
</style>
</head>

<body>

<audio id="bgm" loop>
  <source src="https://raw.githubusercontent.com/rejoicine/Tier-Calculator/main/Bloxd.io_-_Soundtrack_-_Survival_Mode_48KBPS.mp4">
</audio>

<div class="container">
  <button id="musicBtn" onclick="toggleMusic()">ðŸ”Š</button>

  <h2>Bloxd Tier Calculator</h2>
  <div class="subtitle">PvP Skill Assessment â€¢ Bloxd Style</div>

  <div id="scoreBox">
    <b>What was the score?</b>
    <input id="score" placeholder="5-1">
    <button onclick="validateScore()">Next</button>
  </div>

  <div id="rounds"></div>
</div>

<script>
const tiers=['ht1','lt1','ht2','lt2','ht3','lt3','ht4','lt4','ht5','lt5'];
let totalRounds=0,currentRound=1,roundData=[];

const bgm=document.getElementById("bgm");
const musicBtn=document.getElementById("musicBtn");
let musicStarted=false;

function toggleMusic(){
  if(bgm.paused){bgm.play();musicBtn.textContent="ðŸ”Š";}
  else{bgm.pause();musicBtn.textContent="ðŸ”‡";}
}

function markInvalid(el){
  el.classList.remove("invalid");
  void el.offsetWidth;
  el.classList.add("invalid");
}

function swapCard(html){
  const old=rounds.firstElementChild;
  if(old){
    old.classList.add("round-exit");
    old.addEventListener("animationend",()=>rounds.innerHTML=html,{once:true});
  }else rounds.innerHTML=html;
}

function validateScore(){
  const m=score.value.match(/^(\d+)-(\d+)$/);
  if(!m)return markInvalid(score);
  totalRounds=+m[1]+ +m[2];
  scoreBox.classList.add("hidden");
  showRound();
}

function showRound(){
  if(currentRound>totalRounds)return showTierQuestions();
  swapCard(`
    <div class="round-card">
      <h3>Round ${currentRound}</h3>
      Did you win?
      <select id="win">
        <option value="">Select</option>
        <option value="yes">Win</option>
        <option value="no">Loss</option>
      </select>
      <input type="number" id="hp" placeholder="HP" min="0" max="100">
      <button onclick="submitRound()">Next</button>
    </div>
  `);
}

function submitRound(){
  const win=document.getElementById("win");
  const hp=document.getElementById("hp");
  if(!win.value||hp.value==="")return markInvalid(win);
  const val=Math.min(100,Math.max(0,+hp.value));
  roundData.push(win.value==="yes"?val:-val);
  currentRound++;
  showRound();
}

function showTierQuestions(){
  swapCard(`
    <div class="round-card">
      <b>Your tier</b>
      <select id="tier">${tiers.map(t=>`<option>${t}</option>`).join("")}</select>

      <b>Tested before?</b>
      <select id="testedBefore" onchange="togglePrevTier()">
        <option value="">Select</option>
        <option value="no">No</option>
        <option value="yes">Yes</option>
      </select>

      <div id="prevTierWrap" class="hidden">
        <b>Previous tier</b>
        <select id="prevTier">${tiers.map(t=>`<option>${t}</option>`).join("")}</select>
      </div>

      <button onclick="calculate()">Calculate</button>
    </div>
  `);
}

function togglePrevTier(){
  prevTierWrap.classList.toggle("hidden",testedBefore.value!=="yes");
}

/* UPDATED HP â†’ TIER (stronger impact) */
function hpToTier(base,hp){
  let z=(hp+100)/200;
  z=Math.min(Math.max(z,1e-15),1-1e-15);
  return base+4.5*Math.log(z/(1-z));
}

function calculate(){
  let base=tiers.indexOf(tier.value)+1;
  if(testedBefore.value==="yes"){
    base=(base+tiers.indexOf(prevTier.value)+1)/2;
  }
  const avg=roundData.reduce((a,b)=>a+b,0)/roundData.length;
  const raw=hpToTier(base,avg);
  const result=tiers[Math.min(9,Math.max(0,Math.round(raw)-1))];

  swapCard(`
    <div class="tier-card">
      <div class="tier-badge ${result.startsWith("ht")?'ht':'lt'}">
        ${result.toUpperCase()}
      </div>
    </div>
    <div class="copy-box" onclick="copyResult(this)">
      Congrats you got ${result.toUpperCase()}
      Average HP: ${avg.toFixed(2)}
      Score: ${score.value}
    </div>
  `);
}

function copyResult(el){
  navigator.clipboard.writeText(el.innerText);
  el.classList.add("copied");
  setTimeout(()=>el.classList.remove("copied"),800);
}
</script>

</body>
</html>
